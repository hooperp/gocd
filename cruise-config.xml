<?xml version="1.0" encoding="utf-8"?>
<cruise xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="cruise-config.xsd" schemaVersion="77">
  <server artifactsdir="artifacts" commandRepositoryLocation="default" serverId="d06e36f2-1911-4e57-abe3-3f4d2c7e8025" />
  <pipelines group="OrchestraIntegration">
    <pipeline name="pipelineOrchestraBuildAndDeployToNexus" isLocked="false" template="templateBuildAndDeployToNexus">
      <materials>
        <git url="ssh://git@stash.ipttools.info/" branch="develop" materialName="checkoutCode" />
      </materials>
    </pipeline>
  </pipelines>
  <pipelines group="BuildandRunDocker">
    <pipeline name="Docker" isLocked="false">
      <materials>
        <pipeline pipelineName="pipelineOrchestraBuildAndDeployToNexus" stageName="stageBUILD_AND_DEPLOY" materialName="BuildAndDeploy" />
      </materials>
      <stage name="stageBuildDockerImage">
        <approval type="manual" />
        <jobs>
          <job name="jobBuildDockerImage">
            <tasks>
              <exec command="/opt/jenkins_ci_tools/scripts/docker.sh">
                <arg>build</arg>
                <runif status="passed" />
              </exec>
            </tasks>
          </job>
        </jobs>
      </stage>
      <stage name="stageRunDockerImage" fetchMaterials="false">
        <jobs>
          <job name="jobRunDockerImage">
            <tasks>
              <exec command="/opt/jenkins_ci_tools/scripts/docker.sh">
                <arg>run</arg>
                <runif status="passed" />
              </exec>
            </tasks>
          </job>
        </jobs>
      </stage>
    </pipeline>
  </pipelines>
  <pipelines group="IdentityResolution">
    <pipeline name="pipelineBuildAndDeployIdentityResolutionToNexus" isLocked="false" template="templateBuildAndDeployToNexus">
      <materials>
        <git url="ssh://git@stash.ipttools.info/re/ipt-ms-identity-resolution.git" branch="develop" materialName="checkoutCode" />
      </materials>
    </pipeline>
  </pipelines>
  <templates>
    <pipeline name="templateBuildAndDeployToNexus">
      <stage name="stageBUILD_AND_DEPLOY">
        <jobs>
          <job name="jobBUILD_AND_DEPLOY">
            <tasks>
              <exec command="/opt/jenkins_ci_tools/scripts/DeployAndRelease.sh">
                <runif status="passed" />
              </exec>
            </tasks>
          </job>
        </jobs>
      </stage>
      <stage name="stageDEPLOY_RPM" fetchMaterials="false">
        <jobs>
          <job name="jobDEPLOY_RPM" />
        </jobs>
      </stage>
      <stage name="stagePREPARE_RELEASE" fetchMaterials="false">
        <jobs>
          <job name="jobPREPARE_RELEASE" />
        </jobs>
      </stage>
      <stage name="stageDELOY_RELEASE" fetchMaterials="false">
        <jobs>
          <job name="jobDEPLOY_RELESASE" />
        </jobs>
      </stage>
      <stage name="stageReleaseRPM">
        <jobs>
          <job name="jobReleaseRPM" />
        </jobs>
      </stage>
      <stage name="stageINCREMENT_VERSION_NUMBER" fetchMaterials="false">
        <jobs>
          <job name="jobINCREMENT_VERSION_NUMBER" />
        </jobs>
      </stage>
    </pipeline>
  </templates>
  <environments>
    <environment name="CI">
      <environmentvariables>
        <variable name="JAVA_HOME">
          <value>/opt/jdk1.8.0_72/</value>
        </variable>
        <variable name="MAVEN_HOME">
          <value>/opt/apache-maven-3.3.9</value>
        </variable>
        <variable name="PATH">
          <value>/opt/jenkins_ci_tools/scripts:/opt/jdk1.8.0_72/bin:/opt/apache-maven-3.0.5/bin:/opt/jdk1.8.0_72//bin:/opt/apache-maven-3.0.5//bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</value>
        </variable>
      </environmentvariables>
    </environment>
    <environment name="ci-live">
      <environmentvariables>
        <variable name="JAVA_HOME">
          <value>/opt/jdk1.8.0_72/</value>
        </variable>
        <variable name="MAVEN_HOME">
          <value>/opt/apache-maven-3.3.9</value>
        </variable>
        <variable name="PATH">
          <value>/opt/jenkins_ci_tools/scripts:/opt/jdk1.8.0_72/bin:/opt/apache-maven-3.0.5/bin:/opt/jdk1.8.0_72//bin:/opt/apache-maven-3.0.5//bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</value>
        </variable>
      </environmentvariables>
    </environment>
  </environments>
  <agents>
    <agent hostname="localhost.localdomain" ipaddress="10.0.2.15" uuid="3a4c4767-0575-4b61-b4cb-a5b2f6290983" />
  </agents>
</cruise>

